%--------------------------------------------------------------------------------
%\documentclass{article}

\documentclass[a4paper, 12pt]{article}
\usepackage[T1]{fontenc} 
\usepackage[bf]{caption}
\usepackage{hyperref}
\usepackage[all]{hypcap}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage[czech, english]{babel}
\selectlanguage{czech}
\usepackage{subfig}                % \subfloat
\usepackage{color}
\usepackage{url}
\inputencoding{utf8}
%\usepackage[bf]{caption2}
\usepackage{hyperref}
\usepackage[all]{hypcap}
\hypersetup{colorlinks=false, linkbordercolor=1 1 1, citebordercolor=1 1 1}
\usepackage[right]{lineno}
\renewcommand\linenumberfont{\normalfont\tiny\color{blue}}


\title{Dokumentace projektu}
\author{Vít Hodes <xhodes00@stud.fit.vutbr.cz>}
\author{Zden?k Biberle <xbiber00@stud.fit.vutbr.cz>}
\date{\today}


%--------------------------------------------------------------------------------


\begin{document}
\selectlanguage{czech}
\maketitle

\section{Ãšvod}


Tato práce se zabıvá implementací algoritmu Real Time Shadow of Transparent Casters Using Shadow
Volume, kterı jak ji název nazna?uje, popisuje zp?sob ?ešení stín? pomocí objemovıch t?les, aplikovatelnı i
na neuzav?ené modely a tedy i obecné trojuhelníky - tzv. triangle soup. Dále algoritmus popisuje
postup tvorby pr?hlednıch stín? a jejich problémy a moné ?ešení.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Teorie}

Tady v tÃ© kapitole je napsanÃ© jak to funguje. IdeÃ¡lnÄ› nÄ›jaka ta rovnice, napÅ™. \ref{moje-rovnice}. Potom by
tady mÄ›la byt uvedena literatura, ze kterÃ© bylo Äerpano, napÅ™Ã­klad "Metody sledovÃ¡nÃ­ paprsku jsou popsanÃ© v \cite{Byungmoon2007}"


\begin{equation}
  \label{moje-rovnice}
  c = a + b
\end{equation}

Na obrÃ¡zku \ref{fig:obrazek} je ukÃ¡zanÃ© jak to funguje. NÄ›jakÃ© schÃ©mÃ¡tko pipeline..

\begin{figure}[htb]
  \centering
  \includegraphics[width=5cm,keepaspectratio]{obrazek.jpg}
  \caption{NÄ›jakÃ½ ten diagram, tÅ™eba pÅ™evzanÃ½ }
  \label{fig:obrazek}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Popis Å™eÅ¡enÃ­}

Tady struÄnÄ› popiÅ¡te, jakÃ½m zpÅ¯sobem jste prakticky projekt Å™eÅ¡ili. UveÄte zejmÃ©na pouÅ¾itÃ©
technologie a algoritmy. ZamÄ›Å™te se hlavnÄ› na zajÃ­mavÃ© a dÅ¯leÅ¾itÃ© ÄÃ¡sti implementace a takÃ© na
problÃ©my, kterÃ© jste Å™eÅ¡ili. NenÃ­ nutnÃ© popisovat kaÅ¾dou tÅ™Ã­du.

NapÅ™. uveÄte, jak jste matematickÃ½ popis z pÅ™edchozÃ­ kapitoly implementovali prakticky.


Bylo implementováno referen?ní CPU ?ešení, které bylo p?evád?no do compute a geometry shader?.
?ešení se skládá prakticky ze dvou ?ástí - spo?ítání objemovıch t?les zvolenou metodou a potom
samotnı proces vygenerování stín? a vykreslení.

Na za?átku se p?edzpracují modely tak, e se odstraní duplikované vrcholy a vygenerují se nové
vertex a element vektory. Pak se vygeneruje tzv. edgeLookup vektor, ve kterém se z trojuhelník? 
vytvo?í se?azená mnoina hran s t?etím nehranovım vrcholem a id trojuhelníku. Hrany jsou se?azeny
 podle vrcholu 1, pak vrcholu 2 a nakonec podle id trojuhelníku. Toto se?azení umo?uje aby kadou 
sdílenou hranu pak zpracovával jen jeden trojuhelník (ten s nejniším id).

Implementace algoritmu se v jednotlivıch implementacích p?íliš neliší. Ve všech p?ípadech jsou na
vstupu vrcholy modelu, element vektor definující jednotlivé trojuhelníky, edgeLookup, pozice sv?tla a 
poadovaná délka extrudovaného stínu. V compute a geometry shaderech jsou tyto data v SSBO strukturách
(krom? pozice sv?tla a délky stínu - ty jsou oby?ejné uniformy).
 
Pro kadı trojuhelník, pokud je p?ivrácenı ke sv?tlu, se vygeneruje novı extrudovanı o p?íslušnou vzdálenost
od sv?tla. Pro kadou jeho hranu se nalezne trojuhelník s nejniším indexem, kterı ji obsahuje a podle
jeho orientace se nastaví multiplicita hrany (tj zda stín generuje ?í nikoliv).
Pokud je vısledná multiplicita nenulová, vytvo?í se z p?íslušné hrany st?na objemového t?lesa.



Postup kreslení za?íná vykreslením stín?nıch povrch? do hloubkového bufferu, kterı je pouitı p?i 
z-fail generování "stencil" textury stín?. P?i z-fail algoritmu je zápis do hloubkového bufferu vypnutı
a pro kadı fragment, kterı má hloubku v?tší ne je aktuáln? v hloubkovém bufferu atomicky zapíše negativní
hodnotu své multiplicity (pro fragmenty orientované od kamery je tato hodnota ve vısledku kladná a pro
fragmenty orientované ke kame?e záporná), do celo?íselné "stencil" textury. Je také zapnutı early fragment test,
jinak by atomické operace prob?hly i pro fragmenty, které se budou zahazovat.

Se získanou texturou se stínem u sta?í vykreslit znova stín?né p?edm?ty a pak stínící p?edm?ty bez ní.

Zajímavé ?ešené problémy:
Pro atomické load/store operace jsou podporovány pouze celo?íselné formáty textur r32i a r32ui.
AMD má opravdu problém s p?ímım vyuitím hodnot ze SSBO pole, ale zkopírování do pomocné prom?nné tento problém obejde.
Padding vstupních dat je opravdu pot?eba. Dlouho nás ani nenapadlo tam hledat chybu a v?bec se tím zabıvat. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Ovládání­}

T - zapne vykreslování objemovıch t?les
C - p?epíná mezi metodami generování objemovıch t?les
I - zapne zobrazení statistik b?hu programu
R - zastaví rotaci scény
Myš - rotace okolo po?átku scény
Kole?ko - p?iblíení/oddálení pohledu ve scén?
Esc - ukon?í b?h openGL programu, Enter potom celé aplikace

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{VyhodnocenÃ­}

Tady by mÄ›lo bÃ½t napsanÃ© jak to funguje. ProtoÅ¾e se jednÃ¡ o poÄÃ­taÄovou grafiku nebo 
vidÄ›nÃ­, tak by tady mÄ›l byt screenshot, ze ktereho bude poznat jak to funguje.
K tomu by mÄ›la bÃ½t idealnÄ› tabulka s vyhodnocenÃ­m jak pÅ™esnÄ›/rychle to funguje. 

I p?es problémy s AMD hardwarem se nakonec poda?ilo implementaci v compute shaderech zprovoznit.
Problémy byly v paddingu vstupních struktur i samotné implementaci algoritmu, kde se po?ítaly
n?které trojuhelníky navíc. 

----Nejaka tabulka

----Nejaky screenshot..

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{ZÃ¡vÄ›r}

Tady by mÄ›lo bÃ½t struÄnÄ› napsanÃ© jak to funguje.

--znova psat jak to funguje?? 
Funguje to dle o?ekávání. Pom?rn? dob?e. Nebyl ?as.

\bibliographystyle{alpha}
\begin{flushleft}
  \bibliography{project}
\end{flushleft}

%\appendix
%\newpage
%\section{}

\end{document}
